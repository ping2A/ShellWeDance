name: Fairly suspicious keywords
description: This indicator is designed to capture up to 3 low-severity strings through multi-matching (see the maxmatch field below), avoiding the need to create numerous similar-value indicators. As a result, the regex will be long. If a particular string/pattern needs to be highlighted separately, it can be offloaded into its own indicator and removed from this one. The maxmatch field defines how many distinct matches are treated as separate instances of the indicator. It was initially inspired and later expanded from a few Sigma detections (refer to references).
regex: shell\.application|DisableRealtimeMonitoring|password|dump|Obfuscation|sploit|scanner|rundll|Reflection|icm\s+|base64|discover-|IsInRole|Get-WinSystemLocale|Set-Wallpaper|etsn\s+.+(ComputerName|TargetName)|(start|get)-Service.+(ComputerName|TargetName)|gsv\s+.+(ComputerName|TargetName)|get-Credential|(ps|Get-Process)\s+.+(ComputerName|TargetName)|(new|start)-ComplianceSearch|Get-Azure(user|group)|System.IO.File|PasswordSettings|localadmin|downloaddata|get-\S+(credent|password)|System\.Convert|[^\.]+\.dll\b|InteropServices|Get-LocalUser|\b-useb\s|binPath|PowerUp|GetTempFileName|SecurityProtocol|get-netfirewall|winsystemlocale|RemoteConnection|Get-PSSnapin|AntiVirusProduct|ldap://|\s+(start-job|sajb)\s+|ActiveDirectory\.Domain|\b(tnc|Test-NetConnection|Test-Connection)\s+\S+\.\S+\s+[-]port\s+\d+|\bcmd(\.exe)*\s+/c\b|taskkill.+/f|[^\-]encoded|foreach\s[\s\S]+\-join\s|downloadfile|DomainRole|Win32_UserAccount|RunMRU|readAllBytes|Text\.Encoding|SecureString|%[0-9a-z]+%/
max_match: 3
basescore: 4.0
tactic: TA0002
technique: T1059.001
reference:
  - https://github.com/SigmaHQ/sigma/blob/master/rules/windows/powershell/powershell_script/posh_ps_susp_keywords.yml
  - https://github.com/SigmaHQ/sigma/blob/master/rules/windows/powershell/powershell_script/posh_ps_malicious_keywords.yml
