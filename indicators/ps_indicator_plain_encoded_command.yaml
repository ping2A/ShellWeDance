name: Plain encoded command usage
description: >
  Detects the usage of encoded command in multiple forms, excluding advanced obfuscation (refer to other indicators).
  The multiple question marks are needed for disabling group matching.

  Note that the unicodes below refer to Hyphen-Minus (ASCII hyphen) only, which is the standard format. En/m Dash, Horizontal Bar
  and others are covered in other indicators and with advanced deobfuscation logic (API).
# Simplified for Rust regex (original psexposed uses deep nesting; see reference for full pattern)
regex: -(?:enc(?:odedcommand)?|encodedcommand)\s+["']*\s*[A-Za-z0-9+/]{20,}={0,2}
basescore: 4.5
tactic: TA0002
technique: [T1059.001, T1027]
reference:
  - https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_powershell_base64_encoded_cmd_patterns.yml
  - https://detect.fyi/malicious-encoded-powershell-detecting-decoding-modeling-321fd322c6ec