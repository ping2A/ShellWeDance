name: Potential obfuscated encoded command
description: >
  Detects the usage of encoded command in unusual or obfuscated forms, inclduing En/m Dash, Horizontal Bar
  and others such as using / instead of hyphen (-). The multiple question marks are needed for disabling group matching.
  Refer to FAQ entry 3.1 in the reference to use those unicode chars in Splunk/SPL (\x{NNNN}).
regex: "[\u2013\u2014\u2015/](?:ec|e(?:n(?:c(?:o(?:d(?:e(?:d(?:c(?:o(?:m(?:m(?:a(?:n(?:d)?)?)?)?)?)?)?)?)?)?)?)?)?)\\s+[\\\"']*\\s*[a-z0-9+/]{20,}={0,2}|e[^a-z0-9]{1,2}n[^a-z0-9]{1,2}c[^a-z0-9]{1,2}o[^a-z0-9]{1,2}d[^a-z0-9]{1,2}e[^a-z0-9]{1,2}d|c[^a-z0-9]{1,2}o[^a-z0-9]{1,2}m[^a-z0-9]{1,2}m[^a-z0-9]{1,2}a[^a-z0-9]{1,2}n[^a-z0-9]{1,2}d"
basescore: 10
tactic: TA0002
technique: ["T1059.001", "T1027"]
reference:
  - https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_powershell_base64_encoded_cmd_patterns.yml
  - https://detect.fyi/malicious-encoded-powershell-detecting-decoding-modeling-321fd322c6ec
  - https://github.com/avasero/psexposed/blob/main/FAQ.md#31-a-few-notes-to-consider-when-using-regex-in-splunkspl